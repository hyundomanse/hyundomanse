<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="BO.EventSt">
	<typeAlias  alias="commMap" type="com.devwork.common.map.CommonMap"/>
	
	<!-- 페이징 Header -->
	<sql id="pagingHeader">
		<![CDATA[
		SELECT * 
		  FROM (
				SELECT A.*
				     , ROWNUM  AS RNUM
				  FROM (
		]]>	  
	</sql>
	
	<!-- 페이징 Footer -->
	<sql id="pagingFooter">
		<![CDATA[
                       ) A	WHERE ROWNUM <= #lastIndex#
		       ) WHERE RNUM >= #firstIndex#
		]]>
	</sql>
	
	<!--기 등록된 전시관 조회 -->
	<select id="selectStDspyList"  resultClass="commMap">
		SELECT T2.CD_GRP_ID
		     , T2.COMN_CD_ID AS CODE
		     , T2.COMN_CD_NM AS NAME
		  FROM CM_COMN_CD_GRP T1
		     , CM_COMN_CD T2
		 WHERE T1.CD_GRP_ID = T2.CD_GRP_ID
		   AND T1.CD_GRP_ID = 'PAVLN_DIV_CD'     /* 전시관 분류 코드*/
		   AND COMN_CD_ID <![CDATA[<]]> 20 
		 ORDER BY T2.SORT_ORDER ASC
	</select>
	
	<!--기 등록된 상설 이벤트 조회 -->
	<select id="selectStBefList" resultClass="commMap">
		SELECT PLNBEF_ID AS CODE
             , PLNBEF_NM AS NAME
          FROM EV_PLNBEF_MAST
	</select>
	
	<!--상품상태 -->
	<select id="selectGoodsStusCd"  resultClass="commMap">
		SELECT COMN_CD_ID  AS CODE
             , COMN_CD_NM  AS NAME
          FROM CM_COMN_CD
         WHERE CD_GRP_ID = 'SYS_06'
	</select>
	
	<!--판매유형 -->
	<select id="selectSellTypCd"  resultClass="commMap">
		SELECT COMN_CD_ID  AS CODE
             , COMN_CD_NM  AS NAME
          FROM CM_COMN_CD
         WHERE CD_GRP_ID = 'SELL_TYP_CD'
	</select>
	
	
	<!--상설이벤트 관리 전시 위치 조회 -->
	<select id="selectStSoptList"  resultClass="commMap">
		 SELECT DSPY_SPOT_CD 
           FROM DP_DSPY_DTAIL
	</select>
	
	<!-- 상설이벤트 관리 목록 조회 -->
	<select id="selectStEventMgrTotalCnt" parameterClass="java.util.HashMap" resultClass="int">
		<![CDATA[
		SELECT COUNT(1) AS CNT
		  FROM EV_EVENT_MAST T1
		      , DP_DSPY_MAST T2
		 WHERE T1.DSPY_SEQ = T2.DSPY_SEQ
		   AND T2.DSPY_TYP_CD = '20'    /* 20:상설이벤트 30:기획전 40:특판이벤트 50:모바일이벤트 70:모바일특가 */
		   AND T1.DEL_YN = 'N'
		]]>
		 <isNotEmpty property="schEventId">
           AND T1.EVENT_ID    = #schEventId#
         </isNotEmpty>
         <isNotEmpty property="schPavlnDivCd">
           AND T1.PAVLN_DIV_CD = #schPavlnDivCd#
         </isNotEmpty>
         <isNotEmpty property="schEventNm">
           AND T1.EVENT_NM LIKE '%'|| #schEventNm# || '%'
         </isNotEmpty>
         <isNotEmpty property="rdoUseYn">
           AND T2.USE_YN    = #rdoUseYn#
         </isNotEmpty>
         <isNotEmpty property="dspyStusCd">
           AND T2.DSPY_STUS_CD    = #dspyStusCd#
         </isNotEmpty>
         <isNotEmpty property="langCd">
           AND T1.LANG_CD    = #langCd#
         </isNotEmpty>
         <isNotEmpty property="calEventStrtDate">/*상설 이벤트 시작-종료일자*/
		   AND (TO_CHAR(T1.EVENT_STRT_DATE, 'YYYY-MM-DD') BETWEEN #calEventStrtDate# AND #calEventEndDate#
		    OR TO_CHAR(T1.EVENT_END_DATE, 'YYYY-MM-DD') BETWEEN #calEventStrtDate# AND #calEventEndDate#)
		 </isNotEmpty>
			
	</select>	
	
	
	<!-- 상설 이벤트 관리 조회 20160130-->
	<select id="selectEventStMgrList" parameterClass="java.util.HashMap" resultClass="commMap">
		
		<include refid="pagingHeader"/>	
		<![CDATA[
           SELECT T2.DSPY_SEQ 
            	 , T1.PAVLN_DIV_CD                                      									/* 전시관 분류 */
                 , T1.EVENT_ID
                 , T2.TEMPL_SEQ                                                                         	/* 템플릿 일련번호 */
                 , F_GET_COMN_CD_NM('PAVLN_DIV_CD', T1.PAVLN_DIV_CD) AS PAVLN_DIV_NM					    /* 상설 전시관 명 */
                 , T1.EVENT_NM                                                                          	/* 상설 이벤트 명 */
                 , T1.LANG_CD
                 , T1.PSNSER																				/* 주최자 */
                 , (SELECT TEMPL_NM FROM DP_DSPY_TEMPL WHERE TEMPL_SEQ = T2.TEMPL_SEQ ) AS TEMPL_NM     	/*템플릿 명 */
                 , DECODE(T2.USE_YN, 'Y','예','아니오') AS USE_YN_NM                                    	/* 사용여부 */
                 , TO_CHAR(T1.CHG_DATE,'YYYY-MM-DD HH24:MI:SS') AS CHG_DATE                             	/* 최종 수정일자 */
                 , (SELECT ADMINNM
					  FROM MB_SUPP_COMP_MEM_MAST
        			 WHERE SUPP_COMP_ACCESS_NAME = T1.CHGER_ID AND  ROWNUM <= '1' ) AS CHGER_ID             /* 최종 수정자 */                                                       	/*최종 수정 ID*/
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'YYYYMMDD') AS EVENT_STRT_DATE                            	/* 이벤트 시작일 */
                 , TO_CHAR(T1.EVENT_END_DATE,  'YYYYMMDD') AS EVENT_END_DATE                             	/* 이벤트 종료일 */
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'YYYY-MM-DD') || ' ~ ' ||  TO_CHAR(T1.EVENT_END_DATE, 'YYYY-MM-DD') AS EVENT_DATE
                 , T3.DSPY_SPOT_CD                                                                      	/* 전시위치 */
                 , T2.DSPY_STUS_CD                                                                          /* 진행상태코드 */
                 , (SELECT COMN_CD_NM FROM CM_COMN_CD WHERE CD_GRP_ID = 'DSPY_STUS_CD' AND COMN_CD_ID = T2.DSPY_STUS_CD ) AS DSPY_STUS_NM   /* 진행상태 */                                                                    /* 진행상태코드 */
              FROM EV_EVENT_MAST T1,                                                                        /* 이벤트 마스터 */
                   DP_DSPY_MAST T2,                                                                         /* 전시마스터 */
                   DP_DSPY_DTAIL T3                                                                         /* 전시 상세 */
                  /*EV_EVENT_DC_GOODS  T4이벤트 할인 상품 */ 
             WHERE T1.DSPY_SEQ = T2.DSPY_SEQ
               AND T1.DSPY_SEQ = T3.DSPY_SEQ
               AND T2.DSPY_TYP_CD = '20'                                                                     /* 20:상설이벤트 30:기획전 40:특판이벤트 50:모바일이벤트 70:모바일특가 */
               AND T1.DEL_YN = 'N'
            ]]>
                <isNotEmpty property="schEventId">
                  AND T1.EVENT_ID    = #schEventId#
                </isNotEmpty>
                <isNotEmpty property="schPavlnDivCd">
                  AND T1.PAVLN_DIV_CD = #schPavlnDivCd#
                </isNotEmpty>
                <isNotEmpty property="schEventNm">
                  AND T1.EVENT_NM LIKE '%'|| #schEventNm# || '%'
                </isNotEmpty>
                <isNotEmpty property="rdoUseYn">
                  AND T2.USE_YN    = #rdoUseYn#
                </isNotEmpty>
                <isNotEmpty property="dspyStusCd">
                  AND T2.DSPY_STUS_CD    = #dspyStusCd#
                </isNotEmpty>
                <isNotEmpty property="langCd">
                  AND T1.LANG_CD    = #langCd#
                </isNotEmpty>
                <isNotEmpty property="calEventStrtDate">/*상설 이벤트 시작-종료일자*/
					AND (TO_CHAR(T1.EVENT_STRT_DATE, 'YYYY-MM-DD') BETWEEN #calEventStrtDate# AND #calEventEndDate#
					OR TO_CHAR(T1.EVENT_END_DATE, 'YYYY-MM-DD') BETWEEN #calEventStrtDate# AND #calEventEndDate#)
				</isNotEmpty>
	       	ORDER BY T2.DSPY_SEQ DESC
        <include refid="pagingFooter"/>    	
	</select>
	
	
	<!-- 상설 이벤트 관리 상세조회 -->
	<select id="selectStBefDtl" parameterClass="java.util.HashMap" resultClass="commMap">		
		<![CDATA[
            SELECT T2.DSPY_SEQ 
            	 , ROWNUM AS RNUM
				 , T2.USE_YN
            	 , T1.PAVLN_DIV_CD                                      								         /* 전시관 분류 */
                 , T1.EVENT_ID
				 , T1.EVENT_DIV_CD							                                                     /* 이벤트 구분 코드 */
				 , F_GET_COMN_CD_NM('EVENT_DIV_CD', T1.EVENT_DIV_CD) AS EVENT_DIV_NM                             /* 이벤트 구분 명 */
                 , T2.TEMPL_SEQ                                                                                  /* 템플릿 일련번호 */
                 , F_GET_COMN_CD_NM('PAVLN_DIV_CD', T1.PAVLN_DIV_CD) AS PAVLN_DIV_NM					    	 /* 상설 전시관 명 */
                 , T1.EVENT_NM                                                                                   /* 상설 이벤트 명 */
                 , (SELECT TEMPL_NM FROM DP_DSPY_TEMPL WHERE TEMPL_SEQ = T2.TEMPL_SEQ ) AS TEMPL_NM              /* 템플릿 명 */
                 , (SELECT ITM_VIEW_CNT from DP_DSPY_TEMPL_ITM WHERE TEMPL_SEQ = T2.TEMPL_SEQ ) AS TEMPL_IMG_NUM /* 이미지 진열수 */
                 , T1.PSNSER																					 /* 주최자 */
                 , DECODE(T2.USE_YN, 'Y','예','아니오') AS USE_YN_NM                                             /* 사용여부 */
                 , TO_CHAR(T1.CHG_DATE,'YYYY-MM-DD HH24:MI:SS') AS CHG_DATE                             		 /* 최종 수정일자 */
                 , T1.CHGER_ID                                                                          		 /* 최종 수정 ID */
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'YYYYMMDD') AS EVENT_STRT_DATE                            		 /* 이벤트 시작일 */
                 , TO_CHAR(T1.EVENT_END_DATE,  'YYYYMMDD') AS EVENT_END_DATE                             		 /* 이벤트 종료일 */
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'YYYY-MM-DD HH24:MI:SS') AS ALL_EVENT_STRT_DATE
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'HH24')     AS FR_TM
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'MI')       AS FR_MN
                 , TO_CHAR(T1.EVENT_END_DATE, 'YYYY-MM-DD HH24:MI:SS') AS ALL_EVENT_END_DATE
                 , TO_CHAR(T1.EVENT_END_DATE, 'HH24')      AS TO_TM
                 , TO_CHAR(T1.EVENT_END_DATE, 'MI')        AS TO_MN
                 , TO_CHAR(T1.EVENT_STRT_DATE, 'YYYY-MM-DD') || ' ~ ' ||  TO_CHAR(T1.EVENT_END_DATE, 'YYYY-MM-DD') AS EVENT_DATE
                 , T3.DSPY_SPOT_CD                                                                      		 /* 전시위치 */
                 , T2.DSPY_STUS_CD
                 , F_GET_COMN_CD_NM('DSPY_STUS_CD', T2.DSPY_STUS_CD) AS DSPY_STUS_NM	/* 진행상태 */
                 , T1.PLNBEF_MAIN_IMAGE_YN
                 , T1.PLNBEF_MAIN_IMAGE_URL
                 , T1.ATTCHFILE_ID
                 , T1.LANG_CD
             	 , IMAGE.FILE_STRE_PATH AS IMAGE_PATH
             	 , IMAGE.STRE_FILE_NM AS IMAGE_NM
             	 , IMAGE.ORIG_FILE_NM AS IMAGE_ORIG_NM
                 , T1.LOGO_ATTCHFILE_ID
                 , T1.EVENT_DESC
             	 , LOGOIMAGE.FILE_STRE_PATH AS LOGO_IMAGE_PATH
             	 , LOGOIMAGE.STRE_FILE_NM AS LOGO_IMAGE_NM
             	 , LOGOIMAGE.ORIG_FILE_NM AS LOGO_IMAGE_ORIG_NM
             	 , T1.PAVLN_AREA_CD
             	 , T1.PAVLN_DTL_AREA_CD
             	 , F_GET_COMN_CD_NM('PAVLN_DIV_CD', T1.PAVLN_AREA_CD) AS PAVLN_AREA_CD_NM
             	 , T1.IS_MOBILE
              FROM EV_EVENT_MAST T1,                            /* 이벤트 마스터 */
                   DP_DSPY_MAST  T2,                            /* 전시마스터 */
                   DP_DSPY_DTAIL T3,                            /* 전시 상세 */
				   CM_FILE_MGT IMAGE,
				   CM_FILE_MGT LOGOIMAGE
             WHERE T1.DSPY_SEQ = T2.DSPY_SEQ
               AND T1.DSPY_SEQ = T3.DSPY_SEQ
               AND T1.ATTCHFILE_ID = IMAGE.ATTCHFILE_ID(+)
               AND T1.LOGO_ATTCHFILE_ID = LOGOIMAGE.ATTCHFILE_ID(+)
			   AND T1.DSPY_SEQ = #dspySeq#
			]]>
	</select>
	
	<!-- 상설 이벤트 관리 상세조회- 전시상품 정보 -->
	<select id="selectStEventProdList" parameterClass="java.util.HashMap" resultClass="commMap">
		<![CDATA[
			SELECT 
				  ROWNUM AS RNUM
				 , T1.EVENT_ID                               /* 이벤트 ID */
                 , T1.DSPY_SEQ                               /* 전시일련번호 */
                 , T2.TEMPL_SEQ                              /* 템프릿 일련번호 */
                 , T4.GOODS_CD                               /* 상품코드 */
                 , T5.GOODS_NM                               /* 상품명 */
                 , T2.DSPY_STUS_CD                           /* 이벤트 진행 상태 */
                 , (SELECT BCNC_NM 
                      FROM CO_SUPP_COMP_MAST S1 
                     WHERE S1.SUPP_COMP_ID = T5.SUPP_COMP_ID) AS SUPP_COMP_NM    /* 공급업체명 */
                 , T5.STD_SELL_PRC                      /* 기준 판매가  */
                 , T4.DSPY_SPOT_CD                      /* 전시위치 */
                 , T7.FILE_STRE_PATH   				    /* 파일 경로 */
			  	 , T7.STRE_FILE_NM     				    /* 저장 파일명 */
			  	 , T7.ORIG_FILE_NM     				    /* 원본 파일명 */
			  	 , T7.FILE_EXTNER     				    /* 파일 확장명 */
			  	 , T7.ATTCHFILE_ID                      /* 첨부파일 ID */
			  	 , T4.LIMIT_SELL_CNT 				    /* 한정 판매 수량 */
			  	 , T4.BUY_LIMIT_CNT                     /* 구매 제한 수량 */
               	 , T4.DC_APPLY_PRC       				/* 할인 적용가 */
               	 , T2.DSPY_STUS_CD        				/* 이벤트 진행 상태 */
			  	 , REPLACE(T7.FILE_STRE_PATH, '\') || '/' || T7.STRE_FILE_NM || '.' ||  T7.FILE_EXTNER AS FILE_FULL_NAME
              FROM EV_EVENT_MAST  T1                    /* 이벤트 마스터*/   
                 , DP_DSPY_MAST T2                      /* 전시마스터 */   
                 , DP_DSPY_GOODS T3                     /* 전시상품*/   
                 , EV_EVENT_DC_GOODS T4                 /* 이벤트 할인 상품*/   
                 , GD_GOODS_MAST T5                     /* 상품마스터 */
                 , GD_GOODS_IMAGE T6      				/* 상품 이미지 정보 테이블 */
                 , CM_FILE_MGT T7         				/* 이미지 업로드 정보 테이블 */ 
             WHERE T1.DSPY_SEQ  = T2.DSPY_SEQ
               AND T2.DSPY_SEQ  = T3.DSPY_SEQ
               AND T2.DSPY_SEQ  = T4.DSPY_SEQ
               AND T4.GOODS_CD  = T5.GOODS_CD            /* 상품*/
               AND T4.GOODS_CD  = T6.GOODS_CD
               AND T6.REPRSNT_IMAGE = T7.ATTCHFILE_ID
             ]]>
             <isNotEmpty property="eventId">
               AND T1.EVENT_ID = #eventId#
             </isNotEmpty>
             <![CDATA[
             	/*ORDER BY T4.SORT_ORDER ASC */
             	ORDER BY T1.EVENT_ID
             ]]>
	</select>
	
	<!-- 20160125 전시상품 추가 - 조회 수정 old-->
	<select id="selectProdListStTotCnt_old" parameterClass="java.util.HashMap" resultClass="int">		
		<![CDATA[
		 SELECT COUNT(1) AS CNT      
		   FROM GD_GOODS_MAST T1
			  , GD_GOODS_IMAGE T3      	    /* 상품 이미지 정보 테이블 */
			  , CM_FILE_MGT T4         	    /* 이미지 업로드 정보 테이블 */
			  , GD_MGT_GOODS_MAST T2   		/* 관리 상품 마스터 - 공급여부 */
			  , (SELECT * FROM GD_GOODS_CTGRY WHERE BASIC_CTGRY_YN = 'Y' AND USE_YN = 'Y') C              /* 상품 카테고리 테이블 */
			  , CO_SUPP_COMP_MAST T5
			  , CO_PAVLN_MGT T6
		    WHERE 1=1
		      AND T1.GOODS_CD = T2.GOODS_CD
		      AND T1.GOODS_CD = T3.GOODS_CD
		      AND T3.REPRSNT_IMAGE = T4.ATTCHFILE_ID
		      AND T1.SUPP_COMP_ID = T5.SUPP_COMP_ID
		      AND T1.SUPP_COMP_ID = T6.SUPP_COMP_ID
		      AND C.PAVLN_DIV_CD = T6.PAVLN_DIV_CD
		      AND C.GOODS_CD = T1.GOODS_CD
		      AND T1.GOODS_STUS_CD IN ('01', '05')
		      AND T1.STOCK_VOLM > 0
		]]>
		
			<isNotEmpty property="ctgryLvlBot">      /* 카테고리 상품 조회 */
				  AND C.CTGRY_CD = #ctgryLvlBot#
			</isNotEmpty>
			<isNotEmpty property="eventRegStrtDate"> /* 상품등록 시작-종료일자 */
				AND (TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#
				OR TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#)
			</isNotEmpty>
			<isNotEmpty property="basicDcSetYn">
		   		<isEqual property="basicDcSetYn" compareValue="Y"> /* 할인 상품 */
	   			AND T1.BASIC_DC_SET_YN IN('Y')
	   		 	</isEqual>
		   		<isEqual property="basicDcSetYn" compareValue="N"> /* 할인 제외 */
	   			AND (T1.BASIC_DC_SET_YN NOT IN('Y') OR T1.BASIC_DC_SET_YN IS NULL)
	   		 	</isEqual>
	   		 </isNotEmpty>
		   	<isNotEmpty property="search_goods_stus_cd">
		   		<isEqual property="search_goods_stus_cd" compareValue="N">
		   			AND T1.GOODS_STUS_CD NOT IN('02')
	   		 	</isEqual>
	   		 	<isNotEqual property="search_goods_stus_cd" compareValue="N">
	   		 	AND T1.GOODS_STUS_CD = #search_goods_stus_cd#    /* 품절 여부  01:재고있음, 02:품절, 03:절판, 04:판매금지, 05:한정판매*/
		   		</isNotEqual>
		   	</isNotEmpty>	
		   	<isNotEmpty property="suppCompNm">
		   		AND T5.BCNC_NM  LIKE '%' || #suppCompNm# || '%' /* 공급사 명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="suppCompId">
		   		AND T1.SUPP_COMP_ID  LIKE '%'|| #suppCompId# || '%' /* 공급사 코드 */
		   	</isNotEmpty>
		   	<isNotEmpty property="lstGoodsStusCd">
		   		AND T1.GOODS_STUS_CD  = #lstGoodsStusCd#  			/* 상품 유형 */
		   	</isNotEmpty>
		   	<isNotEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = #sellTypCd#  					/* 판매 유형 */
		   	</isNotEmpty>
		   	<isEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = 'G'		  					/* 판매 유형 */
		   	</isEmpty>
		   	<isNotEmpty property="goodsNm">
		   		AND T1.GOODS_NM LIKE '%'|| #goodsNm# || '%'  		/* 상품명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="goodsCd">
		   		AND T1.GOODS_CD LIKE '%'|| #goodsCd# || '%'  		/* 상품코드 */
		   	</isNotEmpty>
		   	<isEqual property="popupType" compareValue="todaySale">
       			<isNotEmpty property="loginId">
     			AND T1.SUPP_COMP_ID = (SELECT SUPP_COMP_ID FROM MB_SUPP_COMP_MEM_MAST WHERE SUPP_COMP_ACCESS_NAME = #loginId#)
       			</isNotEmpty>
     		</isEqual>
     		
     		<isEqual property="search_supp_yn" compareValue="Y">
	  	 	  AND T1.SUPP_BGIN_YMD <![CDATA[<=]]> TO_CHAR(SYSDATE,'YYYYMMDD') AND T1.SUPP_END_YMD <![CDATA[>]]> TO_CHAR(SYSDATE,'YYYYMMDD') /*공급기간 체크*/
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T1.SUPP_DSCNTC_STRT_YMD,'99991231') AND NVL(T1.SUPP_DSCNTC_END_YMD,'99991231') /*공급중지기간 체크*/
			  AND NVL(T1.SUPP_DSCNTC_STUS_CD,'00') = '00'
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T5.CNTRAC_STOP_STRT_YMD,'99991231') AND NVL(T5.CNTRAC_STOP_END_YMD,'99991231')
			  AND T6.SUPP_COMP_STUS_CD IN ('01','05')
			  AND NVL(T5.CNTRAC_DSUSE_YMD,'99991231') <![CDATA[>]]> TO_CHAR(SYSDATE, 'YYYYMMDD') /*계약해지 일자 체크*/
			  AND (CASE WHEN (SELECT COUNT(1) FROM GD_GOODS_CRTFC X
					   WHERE (X.VLD_TERM_END_YMD IS NOT NULL OR TRIM(X.VLD_TERM_END_YMD) != '')
					     AND SUBSTR(X.VLD_TERM_END_YMD,0, 2) != '99'
					     AND X.VLD_TERM_END_YMD <![CDATA[<]]> TO_CHAR(SYSDATE,'YYYYMMDD')
					     AND X.GOODS_CD = T1.GOODS_CD
					     AND X.USE_YN = 'Y') <![CDATA[>]]> 0 THEN 1
				    ELSE 0 END) = 0                /*친환경인증관련 유효성 체크*/
		   </isEqual>
		   
       		<isEqual property="selTyp" compareValue="add">
       			<isNotEmpty property="goodsCdArr" prepend="AND">
       				T1.GOODS_CD IN
					<iterate property="goodsCdArr" open="("  close=")" conjunction=",">
						TRIM(#goodsCdArr[]#)
					</iterate>
       			</isNotEmpty>
       		</isEqual>
	</select>
	
	
	<!-- 20160125 전시상품 추가 - 조회 수정 튜닝-->
	<select id="selectProdListStTotCnt" parameterClass="java.util.HashMap" resultClass="int">		
		<![CDATA[
		 SELECT /*+ INDEX(T1 GD_GOODS_MAST_IX08) */COUNT(1) AS CNT
		   FROM GD_GOODS_MAST T1
			  , GD_GOODS_IMAGE T3      	    /* 상품 이미지 정보 테이블 */
			  , CM_FILE_MGT T4         	    /* 이미지 업로드 정보 테이블 */
			  , GD_MGT_GOODS_MAST T2   		/* 관리 상품 마스터 - 공급여부 */
			  , (SELECT * FROM GD_GOODS_CTGRY WHERE BASIC_CTGRY_YN = 'Y' AND USE_YN = 'Y') C              /* 상품 카테고리 테이블 */
			  , CO_SUPP_COMP_MAST T5
			  , CO_PAVLN_MGT T6
		    WHERE 1=1
		      AND T1.GOODS_CD = T2.GOODS_CD
		      AND T1.GOODS_CD = T3.GOODS_CD
		      AND T3.REPRSNT_IMAGE = T4.ATTCHFILE_ID
		      AND T1.SUPP_COMP_ID = T5.SUPP_COMP_ID
		      AND T1.SUPP_COMP_ID = T6.SUPP_COMP_ID
		      AND C.PAVLN_DIV_CD = T6.PAVLN_DIV_CD
		      AND C.GOODS_CD = T1.GOODS_CD
		      AND T1.GOODS_STUS_CD IN ('01', '05')
		      AND T1.STOCK_VOLM > 0
		]]>
		
			<isNotEmpty property="ctgryLvlBot">      /* 카테고리 상품 조회 */
				  AND C.CTGRY_CD = #ctgryLvlBot#
			</isNotEmpty>
			<isNotEmpty property="eventRegStrtDate"> /* 상품등록 시작-종료일자 */
				AND (TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#
				OR TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#)
			</isNotEmpty>
			<isNotEmpty property="basicDcSetYn">
		   		<isEqual property="basicDcSetYn" compareValue="Y"> /* 할인 상품 */
	   			AND T1.BASIC_DC_SET_YN IN('Y')
	   		 	</isEqual>
		   		<isEqual property="basicDcSetYn" compareValue="N"> /* 할인 제외 */
	   			AND (T1.BASIC_DC_SET_YN NOT IN('Y') OR T1.BASIC_DC_SET_YN IS NULL)
	   		 	</isEqual>
	   		 </isNotEmpty>
		   	<isNotEmpty property="search_goods_stus_cd">
		   		<isEqual property="search_goods_stus_cd" compareValue="N">
		   			AND T1.GOODS_STUS_CD NOT IN('02')
	   		 	</isEqual>
	   		 	<isNotEqual property="search_goods_stus_cd" compareValue="N">
	   		 	AND T1.GOODS_STUS_CD = #search_goods_stus_cd#    /* 품절 여부  01:재고있음, 02:품절, 03:절판, 04:판매금지, 05:한정판매*/
		   		</isNotEqual>
		   	</isNotEmpty>	
		   	<isNotEmpty property="suppCompNm">
		   		AND T5.BCNC_NM  LIKE '%' || #suppCompNm# || '%' /* 공급사 명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="suppCompId">
		   		AND T1.SUPP_COMP_ID  LIKE '%'|| #suppCompId# || '%' /* 공급사 코드 */
		   	</isNotEmpty>
		   	<isNotEmpty property="lstGoodsStusCd">
		   		AND T1.GOODS_STUS_CD  = #lstGoodsStusCd#  			/* 상품 유형 */
		   	</isNotEmpty>
		   	<isNotEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = #sellTypCd#  					/* 판매 유형 */
		   	</isNotEmpty>
		   	<isEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = 'G'		  					/* 판매 유형 */
		   	</isEmpty>
		   	<isNotEmpty property="goodsNm">
		   		AND T1.GOODS_NM LIKE '%'|| #goodsNm# || '%'  		/* 상품명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="goodsCd">
		   		AND T1.GOODS_CD LIKE '%'|| #goodsCd# || '%'  		/* 상품코드 */
		   	</isNotEmpty>
		   	<isEqual property="popupType" compareValue="todaySale">
       			<isNotEmpty property="loginId">
     			AND T1.SUPP_COMP_ID = (SELECT SUPP_COMP_ID FROM MB_SUPP_COMP_MEM_MAST WHERE SUPP_COMP_ACCESS_NAME = #loginId#)
       			</isNotEmpty>
     		</isEqual>
     		
     		<isEqual property="search_supp_yn" compareValue="Y">
	  	 	  AND T1.SUPP_BGIN_YMD <![CDATA[<=]]> TO_CHAR(SYSDATE,'YYYYMMDD') AND T1.SUPP_END_YMD <![CDATA[>]]> TO_CHAR(SYSDATE,'YYYYMMDD') /*공급기간 체크*/
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T1.SUPP_DSCNTC_STRT_YMD,'99991231') AND NVL(T1.SUPP_DSCNTC_END_YMD,'99991231') /*공급중지기간 체크*/
			  AND NVL(T1.SUPP_DSCNTC_STUS_CD,'00') = '00'
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T5.CNTRAC_STOP_STRT_YMD,'99991231') AND NVL(T5.CNTRAC_STOP_END_YMD,'99991231')
			  AND T6.SUPP_COMP_STUS_CD IN ('01','05')
			  AND NVL(T5.CNTRAC_DSUSE_YMD,'99991231') <![CDATA[>]]> TO_CHAR(SYSDATE, 'YYYYMMDD') /*계약해지 일자 체크*/
			  AND (CASE WHEN (SELECT COUNT(1) FROM GD_GOODS_CRTFC X
					   WHERE (X.VLD_TERM_END_YMD IS NOT NULL OR TRIM(X.VLD_TERM_END_YMD) != '')
					     AND SUBSTR(X.VLD_TERM_END_YMD,0, 2) != '99'
					     AND X.VLD_TERM_END_YMD <![CDATA[<]]> TO_CHAR(SYSDATE,'YYYYMMDD')
					     AND X.GOODS_CD = T1.GOODS_CD
					     AND X.USE_YN = 'Y') <![CDATA[>]]> 0 THEN 1
				    ELSE 0 END) = 0                /*친환경인증관련 유효성 체크*/
		   </isEqual>
		   
       		<isEqual property="selTyp" compareValue="add">
       			<isNotEmpty property="goodsCdArr" prepend="AND">
       				T1.GOODS_CD IN
					<iterate property="goodsCdArr" open="("  close=")" conjunction=",">
						TRIM(#goodsCdArr[]#)
					</iterate>
       			</isNotEmpty>
       		</isEqual>
	</select>	
	
	
	<!-- 20160125 전시상품 추가 - 조회 수정-->
	<select id="selectProdStList_old" parameterClass="java.util.HashMap" resultClass="commMap" remapResults="true">		
		
		<include refid="pagingHeader"/>	
		
			 SELECT 
			 		T1.GOODS_CD         /* 상품 코드 */
				  , T1.GOODS_STUS_CD    /* 상품 상태 코드 */
				  , T1.SELL_TYP_CD      /* 판매 유형 코드 */
				  , T1.SUPP_COMP_ID     /* 공급 업체 ID */
				  , F_GET_COMN_CD_NM('SYS_06',T1.GOODS_STUS_CD) AS GOODS_STUS_NM       /* 상품 상태(품절상태) 명 */
				  , F_GET_COMN_CD_NM('SELL_TYP_CD',T1.SELL_TYP_CD)   AS SELL_TYP_NM    /* 판매 유형 명 */
				  , T5.BCNC_NM AS SUPP_COMP_NM    /* 공급 업체 명 */
				  , T1.GOODS_NM         /* 상품 명 */
				 /* , T1.GOODS_DESC        상품 설명 */
				  , T1.CNSMR_PRC        /* 소비자 가 */
				  , T1.STD_SELL_PRC     /* 기준 판매 가 */
				  , T1.STOCK_VOLM       /* 재고 량 */
				  , T1.BASIC_DC_RATE    /* 기본 할인율 */
				  , T1.BASIC_DC_AMT     /* 기본 할인 금액 */
				  , T1.DC_APPLY_PRC     /* 할인 적용 가 */
				  , T4.FILE_STRE_PATH   /* 파일 경로 */
				  , T4.STRE_FILE_NM     /* 저장 파일명 */
				  , T4.ORIG_FILE_NM     /* 원본 파일명 */
				  , REPLACE(T4.FILE_STRE_PATH, '\') || '/' || T4.STRE_FILE_NM AS FILE_FULL_NAME   /* 이미지 풀 경로 */
				  /*, SUPP_DSCNTC_STUS_CD.COMN_CD_NM AS SUPP_DSCNTC_STUS_CD      / 공급 중단 상태*/
				  , DECODE(FN_GOODS_SUPP_YN(T2.GOODS_CD), 'Y', '공급', '공급중단') AS SUPP_YN  
				FROM GD_GOODS_MAST T1
					, GD_GOODS_IMAGE T3      	    /* 상품 이미지 정보 테이블 */
					, CM_FILE_MGT T4         	    /* 이미지 업로드 정보 테이블 */
				    , GD_MGT_GOODS_MAST T2   		/* 관리 상품 마스터 - 공급여부 */
				    , (SELECT * FROM GD_GOODS_CTGRY WHERE BASIC_CTGRY_YN = 'Y' AND USE_YN = 'Y') C              /* 상품 카테고리 테이블 */
				    , CO_SUPP_COMP_MAST T5
				    , CO_PAVLN_MGT T6
			    WHERE 1=1
			      AND T1.GOODS_CD = T2.GOODS_CD
			      AND T1.GOODS_CD = T3.GOODS_CD
			      AND T3.REPRSNT_IMAGE = T4.ATTCHFILE_ID
			      AND T1.SUPP_COMP_ID = T5.SUPP_COMP_ID
			      AND T1.SUPP_COMP_ID = T6.SUPP_COMP_ID
			      AND C.PAVLN_DIV_CD = T6.PAVLN_DIV_CD
			      AND C.GOODS_CD = T1.GOODS_CD
			      AND T1.GOODS_STUS_CD IN ('01', '05')
			      AND T1.STOCK_VOLM > 0
		
			<isNotEmpty property="ctgryLvlBot">/* 카테고리 상품 조회 */
				  AND C.CTGRY_CD = #ctgryLvlBot#
			</isNotEmpty>
		
		
			<isNotEmpty property="eventRegStrtDate">/* 상품등록 시작-종료일자 */
				AND (TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#
				OR TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#)
			</isNotEmpty>
			
			<isNotEmpty property="basicDcSetYn">
		   		<isEqual property="basicDcSetYn" compareValue="Y"> /* 할인 상품 */
	   			AND T1.BASIC_DC_SET_YN IN('Y')
	   		 	</isEqual>
		   		<isEqual property="basicDcSetYn" compareValue="N"> /* 할인 제외 */
	   			AND (T1.BASIC_DC_SET_YN NOT IN('Y') OR T1.BASIC_DC_SET_YN IS NULL)
	   		 	</isEqual>
	   		 </isNotEmpty>
		   	<isNotEmpty property="search_goods_stus_cd">
		   		<isEqual property="search_goods_stus_cd" compareValue="N">
		   			AND T1.GOODS_STUS_CD NOT IN('02')
	   		 	</isEqual>
	   		 	<isNotEqual property="search_goods_stus_cd" compareValue="N">
	   		 	AND T1.GOODS_STUS_CD = #search_goods_stus_cd#    /* 품절 여부  01:재고있음, 02:품절, 03:절판, 04:판매금지, 05:한정판매*/
		   		</isNotEqual>
		   	</isNotEmpty>
		   	<isNotEmpty property="suppCompNm">
		   		AND T5.BCNC_NM  LIKE '%' || #suppCompNm# || '%' /* 공급사 명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="suppCompId">
		   		AND T1.SUPP_COMP_ID  LIKE '%'|| #suppCompId# || '%' /* 공급사 코드 */
		   	</isNotEmpty>
		   	<isNotEmpty property="lstGoodsStusCd">
		   		AND T1.GOODS_STUS_CD  = #lstGoodsStusCd#  			/* 상품 유형 */
		   	</isNotEmpty>
		   	<isNotEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = #sellTypCd#  					/* 판매 유형 */
		   	</isNotEmpty>
		   	<isEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = 'G'		  					/* 판매 유형 */
		   	</isEmpty>
		   	<isNotEmpty property="goodsNm">
		   		AND T1.GOODS_NM LIKE '%'|| #goodsNm# || '%'  		/* 상품명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="goodsCd">
		   		AND T1.GOODS_CD LIKE '%'|| #goodsCd# || '%'  		/* 상품코드 */
		   	</isNotEmpty>
		   	<isEqual property="popupType" compareValue="todaySale">
       			<isNotEmpty property="loginId">
     			AND T1.SUPP_COMP_ID = (SELECT SUPP_COMP_ID FROM MB_SUPP_COMP_MEM_MAST WHERE SUPP_COMP_ACCESS_NAME = #loginId#)
       			</isNotEmpty>
     		</isEqual>
     		
     		<isEqual property="search_supp_yn" compareValue="Y">
	  	 	  AND T1.SUPP_BGIN_YMD <![CDATA[<=]]> TO_CHAR(SYSDATE,'YYYYMMDD') AND T1.SUPP_END_YMD <![CDATA[>]]> TO_CHAR(SYSDATE,'YYYYMMDD') /*공급기간 체크*/
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T1.SUPP_DSCNTC_STRT_YMD,'99991231') AND NVL(T1.SUPP_DSCNTC_END_YMD,'99991231') /*공급중지기간 체크*/
			  AND NVL(T1.SUPP_DSCNTC_STUS_CD,'00') = '00'
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T5.CNTRAC_STOP_STRT_YMD,'99991231') AND NVL(T5.CNTRAC_STOP_END_YMD,'99991231')
			  AND T6.SUPP_COMP_STUS_CD IN ('01','05')
			  AND NVL(T5.CNTRAC_DSUSE_YMD,'99991231') <![CDATA[>]]> TO_CHAR(SYSDATE, 'YYYYMMDD') /*계약해지 일자 체크*/
			  AND (CASE WHEN (SELECT COUNT(1) FROM GD_GOODS_CRTFC X
					   WHERE (X.VLD_TERM_END_YMD IS NOT NULL OR TRIM(X.VLD_TERM_END_YMD) != '')
					     AND SUBSTR(X.VLD_TERM_END_YMD,0, 2) != '99'
					     AND X.VLD_TERM_END_YMD <![CDATA[<]]> TO_CHAR(SYSDATE,'YYYYMMDD')
					     AND X.GOODS_CD = T1.GOODS_CD
					     AND X.USE_YN = 'Y') <![CDATA[>]]> 0 THEN 1
				    ELSE 0 END) = 0                /*친환경인증관련 유효성 체크*/
		   </isEqual>
     		
       		<isEqual property="selTyp" compareValue="add">
       			<isNotEmpty property="goodsCdArr" prepend="AND">
       				T1.GOODS_CD IN
					<iterate property="goodsCdArr" open="("  close=")" conjunction=",">
						TRIM(#goodsCdArr[]#)
					</iterate>
       			</isNotEmpty>
       		</isEqual>
	       	ORDER BY T1.GOODS_CD DESC
		 <include refid="pagingFooter"/>	
	</select>
	
	<!-- 20160125 전시상품 추가 - 조회 수정 튜닝-->
	<select id="selectProdStList" parameterClass="java.util.HashMap" resultClass="commMap" remapResults="true">		
		
	 SELECT /*+ no_merge  push_pred */   * 
	    FROM (
	    SELECT /*+ no_merge  push_pred */   A.*
	         , ROWNUM  AS RNUM
	      FROM (
			 SELECT /*+ no_merge  push_pred */
			 		T1.GOODS_CD         /* 상품 코드 */
				  , T1.GOODS_STUS_CD    /* 상품 상태 코드 */
				  , T1.SELL_TYP_CD      /* 판매 유형 코드 */
				  , T1.SUPP_COMP_ID     /* 공급 업체 ID */
				  , F_GET_COMN_CD_NM('SYS_06',T1.GOODS_STUS_CD) AS GOODS_STUS_NM       /* 상품 상태(품절상태) 명 */
				  , F_GET_COMN_CD_NM('SELL_TYP_CD',T1.SELL_TYP_CD)   AS SELL_TYP_NM    /* 판매 유형 명 */
				  , T5.BCNC_NM AS SUPP_COMP_NM    /* 공급 업체 명 */
				  , T1.GOODS_NM         /* 상품 명 */
				 /* , T1.GOODS_DESC        상품 설명 */
				  , T1.CNSMR_PRC        /* 소비자 가 */
				  , T1.STD_SELL_PRC     /* 기준 판매 가 */
				  , T1.STOCK_VOLM       /* 재고 량 */
				  , T1.BASIC_DC_RATE    /* 기본 할인율 */
				  , T1.BASIC_DC_AMT     /* 기본 할인 금액 */
				  , T1.DC_APPLY_PRC     /* 할인 적용 가 */
				  , T4.FILE_STRE_PATH   /* 파일 경로 */
				  , T4.STRE_FILE_NM     /* 저장 파일명 */
				  , T4.ORIG_FILE_NM     /* 원본 파일명 */
				  , REPLACE(T4.FILE_STRE_PATH, '\') || '/' || T4.STRE_FILE_NM AS FILE_FULL_NAME   /* 이미지 풀 경로 */
				  /*, SUPP_DSCNTC_STUS_CD.COMN_CD_NM AS SUPP_DSCNTC_STUS_CD      / 공급 중단 상태*/
				  , DECODE(FN_GOODS_SUPP_YN(T2.GOODS_CD), 'Y', '공급', '공급중단') AS SUPP_YN  
				FROM GD_GOODS_MAST T1
					, GD_GOODS_IMAGE T3      	    /* 상품 이미지 정보 테이블 */
					, CM_FILE_MGT T4         	    /* 이미지 업로드 정보 테이블 */
				    , GD_MGT_GOODS_MAST T2   		/* 관리 상품 마스터 - 공급여부 */
				    , (SELECT * FROM GD_GOODS_CTGRY WHERE BASIC_CTGRY_YN = 'Y' AND USE_YN = 'Y') C              /* 상품 카테고리 테이블 */
				    , CO_SUPP_COMP_MAST T5
				    , CO_PAVLN_MGT T6
			    WHERE 1=1
			      AND T1.GOODS_CD = T2.GOODS_CD
			      AND T1.GOODS_CD = T3.GOODS_CD
			      AND T3.REPRSNT_IMAGE = T4.ATTCHFILE_ID
			      AND T1.SUPP_COMP_ID = T5.SUPP_COMP_ID
			      AND T1.SUPP_COMP_ID = T6.SUPP_COMP_ID
			      AND C.PAVLN_DIV_CD = T6.PAVLN_DIV_CD
			      AND C.GOODS_CD = T1.GOODS_CD
			      AND T1.GOODS_STUS_CD IN ('01', '05')
			      AND T1.STOCK_VOLM > 0
		
			<isNotEmpty property="ctgryLvlBot">/* 카테고리 상품 조회 */
				  AND C.CTGRY_CD = #ctgryLvlBot#
			</isNotEmpty>
		
		
			<isNotEmpty property="eventRegStrtDate">/* 상품등록 시작-종료일자 */
				AND (TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#
				OR TO_CHAR(T1.REG_DATE, 'YYYY-MM-DD') BETWEEN #eventRegStrtDate# AND #eventRegEndDate#)
			</isNotEmpty>
			
			<isNotEmpty property="basicDcSetYn">
		   		<isEqual property="basicDcSetYn" compareValue="Y"> /* 할인 상품 */
	   			AND T1.BASIC_DC_SET_YN IN('Y')
	   		 	</isEqual>
		   		<isEqual property="basicDcSetYn" compareValue="N"> /* 할인 제외 */
	   			AND (T1.BASIC_DC_SET_YN NOT IN('Y') OR T1.BASIC_DC_SET_YN IS NULL)
	   		 	</isEqual>
	   		 </isNotEmpty>
		   	<isNotEmpty property="search_goods_stus_cd">
		   		<isEqual property="search_goods_stus_cd" compareValue="N">
		   			AND T1.GOODS_STUS_CD NOT IN('02')
	   		 	</isEqual>
	   		 	<isNotEqual property="search_goods_stus_cd" compareValue="N">
	   		 	AND T1.GOODS_STUS_CD = #search_goods_stus_cd#    /* 품절 여부  01:재고있음, 02:품절, 03:절판, 04:판매금지, 05:한정판매*/
		   		</isNotEqual>
		   	</isNotEmpty>
		   	<isNotEmpty property="suppCompNm">
		   		AND T5.BCNC_NM  LIKE '%' || #suppCompNm# || '%' /* 공급사 명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="suppCompId">
		   		AND T1.SUPP_COMP_ID  LIKE '%'|| #suppCompId# || '%' /* 공급사 코드 */
		   	</isNotEmpty>
		   	<isNotEmpty property="lstGoodsStusCd">
		   		AND T1.GOODS_STUS_CD  = #lstGoodsStusCd#  			/* 상품 유형 */
		   	</isNotEmpty>
		   	<isNotEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = #sellTypCd#  					/* 판매 유형 */
		   	</isNotEmpty>
		   	<isEmpty property="sellTypCd">
		   		AND T1.SELL_TYP_CD  = 'G'		  					/* 판매 유형 */
		   	</isEmpty>
		   	<isNotEmpty property="goodsNm">
		   		AND T1.GOODS_NM LIKE '%'|| #goodsNm# || '%'  		/* 상품명 */
		   	</isNotEmpty>
		   	<isNotEmpty property="goodsCd">
		   		AND T1.GOODS_CD LIKE '%'|| #goodsCd# || '%'  		/* 상품코드 */
		   	</isNotEmpty>
		   	<isEqual property="popupType" compareValue="todaySale">
       			<isNotEmpty property="loginId">
     			AND T1.SUPP_COMP_ID = (SELECT SUPP_COMP_ID FROM MB_SUPP_COMP_MEM_MAST WHERE SUPP_COMP_ACCESS_NAME = #loginId#)
       			</isNotEmpty>
     		</isEqual>
     		
     		<isEqual property="search_supp_yn" compareValue="Y">
	  	 	  AND T1.SUPP_BGIN_YMD <![CDATA[<=]]> TO_CHAR(SYSDATE,'YYYYMMDD') AND T1.SUPP_END_YMD <![CDATA[>]]> TO_CHAR(SYSDATE,'YYYYMMDD') /*공급기간 체크*/
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T1.SUPP_DSCNTC_STRT_YMD,'99991231') AND NVL(T1.SUPP_DSCNTC_END_YMD,'99991231') /*공급중지기간 체크*/
			  AND NVL(T1.SUPP_DSCNTC_STUS_CD,'00') = '00'
			  AND TO_CHAR(SYSDATE, 'YYYYMMDD') NOT BETWEEN NVL(T5.CNTRAC_STOP_STRT_YMD,'99991231') AND NVL(T5.CNTRAC_STOP_END_YMD,'99991231')
			  AND T6.SUPP_COMP_STUS_CD IN ('01','05')
			  AND NVL(T5.CNTRAC_DSUSE_YMD,'99991231') <![CDATA[>]]> TO_CHAR(SYSDATE, 'YYYYMMDD') /*계약해지 일자 체크*/
			  AND (CASE WHEN (SELECT COUNT(1) FROM GD_GOODS_CRTFC X
					   WHERE (X.VLD_TERM_END_YMD IS NOT NULL OR TRIM(X.VLD_TERM_END_YMD) != '')
					     AND SUBSTR(X.VLD_TERM_END_YMD,0, 2) != '99'
					     AND X.VLD_TERM_END_YMD <![CDATA[<]]> TO_CHAR(SYSDATE,'YYYYMMDD')
					     AND X.GOODS_CD = T1.GOODS_CD
					     AND X.USE_YN = 'Y') <![CDATA[>]]> 0 THEN 1
				    ELSE 0 END) = 0                /*친환경인증관련 유효성 체크*/
		   </isEqual>
     		
       		<isEqual property="selTyp" compareValue="add">
       			<isNotEmpty property="goodsCdArr" prepend="AND">
       				T1.GOODS_CD IN
					<iterate property="goodsCdArr" open="("  close=")" conjunction=",">
						TRIM(#goodsCdArr[]#)
					</iterate>
       			</isNotEmpty>
       		</isEqual>
	       	ORDER BY T1.GOODS_CD DESC
		 <include refid="pagingFooter"/>	
	</select>	
	
	
	<!-- 상설 이벤트 전시 저장,업데이트 /*, #lstPavlnDivId#     / 전시관 */-->
	<insert id="insertDspyMast" parameterClass="java.util.HashMap">
	<![CDATA[
		MERGE INTO DP_DSPY_MAST T1
		       USING (
		       		SELECT  #dspySeq#                                       AS DSPY_SEQ             /* 전시 일련번호   */
                          , #calEventStrtDate#  || #txFrTm# || #txFrMn# || '00' AS DSPY_STRT_DATE   /* 전시 시작 일시  */
                          , #calEventEndDate#   || #txToTm# || #txToMn# || '59' AS DSPY_END_DATE    /* 전시 종료 일시  */
                          , #useYn#                                         AS USE_YN               /* 사용 여부       */
                          , #eventNm#                                       AS DSPY_NM              /* 전시 명         */
                          , #templSeq#                                      AS TEMPL_SEQ            /* 템플릿 일련번호 */
                          , NVL(#regerId#, 'ADMIN')                         AS REGER_ID             /* 등록자 아이디   */
                          , NVL(#chgerId#, 'ADMIN')                         AS CHGER_ID             /* 수정자 아이디   */
                          , #dspyStusCd#                                    AS DSPY_STUS_CD         /* 진행상태 1:진행대기 2:진행중 3:일시중지 4:종료 */
                          , #contsDivCd#			                        AS CONTS_DIV_CD		    /* 컨텐츠 분류 코드*/
                          , #dspyTypCd#			                            AS DSPY_TYP_CD		    /* 20:상설이벤트 30:기획전 40:특판이벤트 50:모바일이벤트 70:모바일특가 */
		       		  FROM DUAL
		       ) T2
		       ON (T1.DSPY_SEQ = T2.DSPY_SEQ)
		       WHEN MATCHED THEN
		       	   UPDATE 
		       	      SET DSPY_STRT_DATE = TO_DATE(T2.DSPY_STRT_DATE,'YYYYMMDDHH24MISS')
		       	        , DSPY_END_DATE  = TO_DATE(T2.DSPY_END_DATE ,'YYYYMMDDHH24MISS')
		       	        , USE_YN         = #useYn#
		       	        , DSPY_NM        = #dspyNm#		       	        
		       	        , TEMPL_SEQ      = #templSeq#
		       	        , CHG_DATE       = SYSDATE
		       	        , CHGER_ID       = NVL(#chgerId#, 'ADMIN')
		       	        , DSPY_STUS_CD   = #dspyStusCd#
		       WHEN NOT MATCHED THEN
			       INSERT(
				       	    T1.DSPY_SEQ
			       	      , T1.CONTS_DIV_CD
			       	      , T1.DSPY_TYP_CD
                          , T1.DSPY_STRT_DATE
                          , T1.DSPY_END_DATE
                          , T1.DSPY_STUS_CD
                          , T1.USE_YN
                          , T1.DSPY_NM
                          , T1.TEMPL_SEQ
                          , T1.REG_DATE
                          , T1.CHG_DATE
                          , T1.REGER_ID
                          , T1.CHGER_ID
                          , T1.DEL_YN
			       )VALUES(
			       		    T2.DSPY_SEQ
			       		  , T2.CONTS_DIV_CD
			       		  , T2.DSPY_TYP_CD                                     
                          , TO_DATE(T2.DSPY_STRT_DATE,'YYYYMMDDHH24MISS')
                          , TO_DATE(T2.DSPY_END_DATE ,'YYYYMMDDHH24MISS')
                          , T2.DSPY_STUS_CD
                          , T2.USE_YN
                          , T2.DSPY_NM
                          , T2.TEMPL_SEQ
                          , SYSDATE
                          , SYSDATE
                          , T2.REGER_ID
                          , T2.CHGER_ID
                          , 'N'
			       ) 
	]]>
	</insert>
	
	<!-- 상설 이벤트 전시 키조회-->
	<select id="selectDspyMastKey" parameterClass="java.util.HashMap" resultClass="commMap">
	<![CDATA[
		SELECT SEQ_DSPY_SEQ.NEXTVAL AS DSPY_SEQ FROM DUAL
	]]>
	</select>
	<!-- 상설 이벤트 전시 관리 신규 저장을 위한 eventId 키조회-->
	<select id="selectStMastKey" parameterClass="java.util.HashMap" resultClass="commMap">
	<![CDATA[
		 SELECT SEQ_EVENT_ID.NEXTVAL AS EVENT_ID FROM DUAL
	]]>
	</select>
	
	<!-- 상설 이벤트 관리 저장,업데이트-->
	<insert id="insertEventMastMgr" parameterClass="java.util.HashMap">
		MERGE INTO EV_EVENT_MAST T1   /* 이벤트 마스터*/
		       USING (
		       		SELECT #eventId#          AS EVENT_ID	              /* 이벤트 ID*/
		       		     , #dspySeq#          AS DSPY_SEQ                 /* 전시 일련번호*/
		       		     , #eventDivCd#       AS EVENT_DIV_CD             /* 이벤트 구분 코드*/
		       		     , #psnser#     	  AS PSNSER      	          /* 주최자 */
		       		     , #lstPavlnDivId#    AS PAVLN_DIV_CD             /* 전시관 ID*/
		       		     , #txEventNm#        AS EVENT_NM	              /* 이벤트 명*/
		       		     , #calEventStrtDate# || #txFrTm# || #txFrMn# || '00' AS EVENT_STRT_DATE	/* 이벤트 시작 일시 */
						 , #calEventEndDate#  || #txToTm# || #txToMn# || '59' AS EVENT_END_DATE		/* 이벤트 종료 일시 */
		       		     , #plnbefMainImageYn#	 AS PLNBEF_MAIN_IMAGE_YN  /*메인 이미지 사용여부 */
		       		     , #plnbefMainImageUrl#	 AS PLNBEF_MAIN_IMAGE_URL /*메인 이미지 URL */
		       		     , #attchfileId#		 AS ATTCHFILE_ID          /* 이미지 첨부파일 */
		       		     , #logoAttchfileId#     AS LOGO_ATTCHFILE_ID	  /* 로고 이미지 첨부파일 */
		       		     , #eventDesc#			 AS EVENT_DESC 			  /* 로고 텍스트 */
		       		     , #regerId#			 AS REGER_ID	          /* 등록자 아이디 */
		       		     , #chgerId#          	 AS CHGER_ID	          /* 수정자 아이디 */
		       		     , #rdoUseYn#         	 AS BEFCITY_YN            /* 전시 사용여부 */ 
		       		     , #txEventNm#        	 AS EVENT_TTL             /* 이벤트 제목 */
		       		     , #langCd#				 AS LANG_CD		          /* 이벤트 언어 구분 코드 */
		       		     , #pavlnAreaCd#		 AS PAVLN_AREA_CD         /* 전시 영역 */
  						 , #pavlnDtlAreaCd#		 AS PAVLN_DTL_AREA_CD     /* 전시 상세영역 */
  						 , #dspyStusCd#			 AS EVENT_STUS_CD	      /* 이벤트 상태코드 */
  						 , #isMobile#			 AS IS_MOBILE			  /* 웹, 모바일 구분 */
		       		  FROM DUAL
		       ) T2
		       ON (T1.DSPY_SEQ = T2.DSPY_SEQ)
		       WHEN MATCHED THEN
		       	   UPDATE SET T1.EVENT_NM         = T2.EVENT_NM
		       	            , T1.PAVLN_DIV_CD     = T2.PAVLN_DIV_CD
		       	            , T1.EVENT_DIV_CD	  = T2.EVENT_DIV_CD
		       	            , T1.PSNSER	  		  = T2.PSNSER
		       	            , T1.CHGER_ID         = T2.CHGER_ID
		       	            , T1.CHG_DATE         = SYSDATE
		       	            , T1.BEFCITY_YN       = BEFCITY_YN
		       	            , T1.EVENT_STRT_DATE  = TO_DATE(T2.EVENT_STRT_DATE,'YYYYMMDDHH24MISS')
	                        , T1.EVENT_END_DATE   = TO_DATE(T2.EVENT_END_DATE,'YYYYMMDDHH24MISS')
		                    , T1.PLNBEF_MAIN_IMAGE_YN	= T2.PLNBEF_MAIN_IMAGE_YN
		                    , T1.PLNBEF_MAIN_IMAGE_URL	= T2.PLNBEF_MAIN_IMAGE_URL
		                    , T1.LANG_CD		  = T2.LANG_CD
		                    , T1.PAVLN_AREA_CD	  = T2.PAVLN_AREA_CD
		                    , T1.PAVLN_DTL_AREA_CD = T2.PAVLN_DTL_AREA_CD
		                    , T1.EVENT_STUS_CD	  = T2.EVENT_STUS_CD
							, T1.EVENT_DESC		  = T2.EVENT_DESC
							, T1.IS_MOBILE			= T2.IS_MOBILE
						<isNotEmpty property="attchfileId" prepend=",">
							T1.ATTCHFILE_ID	= T2.ATTCHFILE_ID
						</isNotEmpty>
						<isEmpty property="attchfileId">
							<isEqual property="imageDelyn" compareValue="Y" prepend=",">
								ATTCHFILE_ID = NULL
							</isEqual>
						</isEmpty>
						<isNotEmpty property="logoAttchfileId" prepend=",">
							T1.LOGO_ATTCHFILE_ID = T2.LOGO_ATTCHFILE_ID
						</isNotEmpty>
						<isEmpty property="logoAttchfileId">
							<isEqual property="logoImageDelyn" compareValue="Y" prepend=",">
								LOGO_ATTCHFILE_ID = NULL
							</isEqual>
						</isEmpty>
		       WHEN NOT MATCHED THEN
			       INSERT(
				       	  T1.EVENT_ID
				       	, T1.DSPY_SEQ
				       	, T1.PAVLN_DIV_CD
	                    , T1.EVENT_NM
	                    , T1.EVENT_TTL
	                    , T1.EVENT_DIV_CD
	                    , T1.PSNSER
	                    , T1.EVENT_STRT_DATE
	                    , T1.EVENT_END_DATE
	                    , T1.PLNBEF_MAIN_IMAGE_YN
	                    , T1.PLNBEF_MAIN_IMAGE_URL
	                    , T1.ATTCHFILE_ID
	                    , T1.LOGO_ATTCHFILE_ID
	                    , T1.EVENT_DESC
	                    , T1.LANG_CD
	                    , T1.PAVLN_AREA_CD
	                    , T1.PAVLN_DTL_AREA_CD
	                    , T1.EVENT_STUS_CD
	                    , T1.REG_DATE
	                    , T1.CHG_DATE
	                    , T1.CHGER_ID
	                    , T1.REGER_ID
	                    , T1.BEFCITY_YN
	                    , T1.DEL_YN
	                    , T1.IS_MOBILE
			       )VALUES(
			       		  T2.EVENT_ID
				       	, T2.DSPY_SEQ
				       	, T2.PAVLN_DIV_CD
	                    , T2.EVENT_NM
	                    , T2.EVENT_TTL
	                    , T2.EVENT_DIV_CD
				       	, T2.PSNSER
	                    , TO_DATE(T2.EVENT_STRT_DATE,'YYYYMMDDHH24MISS')
	                    , TO_DATE(T2.EVENT_END_DATE,'YYYYMMDDHH24MISS')
	                    , T2.PLNBEF_MAIN_IMAGE_YN
	                    , T2.PLNBEF_MAIN_IMAGE_URL
	                    , T2.ATTCHFILE_ID
	                    , T2.LOGO_ATTCHFILE_ID
	                    , T2.EVENT_DESC
	                    , T2.LANG_CD
	                    , T2.PAVLN_AREA_CD
	                    , T2.PAVLN_DTL_AREA_CD
	                    , T2.EVENT_STUS_CD
	                    , SYSDATE
	                    , SYSDATE
	                    , T2.CHGER_ID
	                    , T2.REGER_ID
	                    , T2.BEFCITY_YN
	                    , 'N'
	                    , T2.IS_MOBILE
			       ) 
	</insert>
	
	<!-- , TO_DATE(T2.PLNBEF_STRT_DATE,'YYYYMMDDHH24MISS')
	-->
	<insert id="insertEventStDpDtailMgr" parameterClass="java.util.HashMap">
	<![CDATA[
		MERGE INTO DP_DSPY_DTAIL T1   /* 전시_상세 테이블*/
		       USING (
		       		SELECT #dspySeq#           AS DSPY_SEQ                   /* 전시 일련번호*/
		       		     , #dspyDtailSeq#      AS DSPY_DTAIL_SEQ             /* 전시 상세 일련번호*/
		       		     , #dspySpotCd#        AS DSPY_SPOT_CD	             /* 전시 위치 코드*/		       		     
		       		     , #dspyItmTtl#        AS DSPY_ITM_TTL               /* 전시 아이템 제목*/
		       		     , #dspyiTmImagePath#  AS DSPY_ITM_IMAGE_PATH	     /* 전시 아이템 이미지 경로*/
		       		     , #dspyItmLinkPath#   AS DSPY_ITM_LINK_PATH	     /* 전시 아이템 링크 경로*/
		       		     , #sortOrder#         AS SORT_ORDER	             /* 정렬 순서*/
						 , #useYn#             AS USE_YN 					 /* 사용 여부*/
						 , SYSDATE			   AS REG_DATE 					 /* 등록 일시*/
						 , SYSDATE        	   AS CHG_DATE 					 /* 수정 일시*/
						 , #regerId#           AS REGER_ID 					 /* 등록자 아이디*/
						 , #chgerId#           AS CHGER_ID 					 /* 수정자 아이디*/
		       		  FROM DUAL
		       ) T2
		       ON (T1.DSPY_SEQ = T2.DSPY_SEQ)
		       WHEN MATCHED THEN
		       	   UPDATE SET T1.DSPY_SPOT_CD            = T2.DSPY_SPOT_CD
		       	            , T1.DSPY_ITM_TTL            = T2.DSPY_ITM_TTL
		       	            , T1.DSPY_ITM_IMAGE_PATH     = T2.DSPY_ITM_IMAGE_PATH
		       	            , T1.DSPY_ITM_LINK_PATH      = T2.DSPY_ITM_LINK_PATH 
		       	            , T1.SORT_ORDER              = T2.SORT_ORDER
		       	            , T1.USE_YN                  = T2.USE_YN
		       	            , T1.CHG_DATE                = SYSDATE
		       	            , T1.CHGER_ID                = T2.CHGER_ID
		       WHEN NOT MATCHED THEN
			       INSERT(
				       	  T1.DSPY_SEQ                  /* 전시 일련번호*/
		       		 	 , T1.DSPY_DTAIL_SEQ           /* 전시 상세 일련번호*/
		       		 	 , T1.DSPY_SPOT_CD	           /* 전시 위치 코드*/		       		     
		       		 	 , T1.DSPY_ITM_TTL             /* 전시 아이템 제목*/
		       		 	 , T1.DSPY_ITM_IMAGE_PATH	   /* 전시 아이템 이미지 경로*/
		       		 	 , T1.DSPY_ITM_LINK_PATH	   /* 전시 아이템 링크 경로*/
		       		 	 , T1.SORT_ORDER	           /* 정렬 순서*/
				 	 	 , T1.USE_YN 				   /* 사용 여부*/
				 	 	 , T1.REG_DATE 				   /* 등록 일시*/
				 	 	 , T1.CHG_DATE 				   /* 수정 일시*/
				 	 	 , T1.REGER_ID 				   /* 등록자 아이디*/
				 	 	 , T1.CHGER_ID 				   /* 수정자 아이디*/
			       )VALUES(
			       		   T2.DSPY_SEQ                     /* 전시 일련번호*/
		       		 	  , (SELECT NVL(MAX(DSPY_DTAIL_SEQ)+1,1) FROM DP_DSPY_DTAIL WHERE DSPY_SEQ = #dspySeq#) /* 전시 상세 일련번호*/
		       		 	  , T2.DSPY_SPOT_CD	               /* 전시 위치 코드*/		       		     
		       		 	  , T2.DSPY_ITM_TTL                /* 전시 아이템 제목*/
		       		 	  , T2.DSPY_ITM_IMAGE_PATH	       /* 전시 아이템 이미지 경로*/
		       		 	  , T2.DSPY_ITM_LINK_PATH	       /* 전시 아이템 링크 경로*/
		       		 	  , T2.SORT_ORDER	               /* 정렬 순서*/
				 	 	  , T2.USE_YN 					   /* 사용 여부*/
				 	 	  , SYSDATE 					   /* 등록 일시*/
				 	 	  , SYSDATE 					   /* 수정 일시*/
				 	 	  , T2.REGER_ID 				   /* 등록자 아이디*/
				 	 	  , T2.CHGER_ID 				   /* 수정자 아이디*/
			       )
	]]>
	</insert>
	
	<!-- 상설 이벤트 관리 삭제 -->
	<update id="deleteEventSt" parameterClass="java.util.HashMap">
		 UPDATE EV_EVENT_MAST
		    SET DEL_YN = 'Y'
		  WHERE DSPY_SEQ = #dspySeq#
		 
	</update>
	<!-- 상설 이벤트 전시 삭제 -->
	<update id="deleteEventStDspy" parameterClass="java.util.HashMap">
		 UPDATE DP_DSPY_MAST
		    SET DEL_YN = 'Y'
		  WHERE DSPY_SEQ = #dspySeq#
	</update>
	

	<!-- 상설 이벤트 전시상품 삭제-->
	<delete id="deleteEventStGoods" parameterClass="java.util.HashMap">
	<![CDATA[
		DELETE 
		  FROM DP_DSPY_GOODS T1
		 WHERE DSPY_SEQ = #dspySeq#
	]]>
	</delete>
	
	<!-- 상설 이벤트 이벤트 할인 상품 삭제-->
	<delete id="deleteEventStDcGoods" parameterClass="java.util.HashMap">
	<![CDATA[
		DELETE 
		  FROM EV_EVENT_DC_GOODS T1
		 WHERE DSPY_SEQ = #dspySeq#
	]]>
	</delete>
	
	
	<!-- 상설 이벤트(전시상품) 저장,업데이트 -->
	<insert id="insertEventStProd" parameterClass="java.util.HashMap">
	<![CDATA[
		  MERGE INTO  DP_DSPY_GOODS T1
           USING (
                SELECT #dspySeq#       AS DSPY_SEQ				/* 전시일련번호*/
                     , NVL(#pavlnDivCd#, '99') AS PAVLN_DIV_CD	/* 전시관 분류 코드 */
                     , #dspyNm#        AS DSPY_NM              	/* 전시명*/
                     , SYSDATE         AS REG_DATE           	/* 등록일시*/
                     , SYSDATE         AS CHG_DATE           	/* 수정일시*/
                     , #regerId#       AS REGER_ID        		/* 등록자 아이디*/
                     , #chgerId#       AS CHGER_ID     			/* 수정자 아이디*/
                     FROM DUAL
           ) T2
           ON (T1.DSPY_SEQ = T2.DSPY_SEQ )
           WHEN MATCHED THEN
                  UPDATE SET T1.CHGER_ID         = T2.CHGER_ID
                           , T1.CHG_DATE         = SYSDATE
           WHEN NOT MATCHED THEN
               INSERT(
                      T1.DSPY_SEQ
                    , T1.PAVLN_DIV_CD
                    , T1.DSPY_NM
                    , T1.REG_DATE
                    , T1.CHG_DATE
                    , T1.REGER_ID
                    , T1.CHGER_ID
               )VALUES(
                      T2.DSPY_SEQ
                    , T2.PAVLN_DIV_CD
                    , T2.DSPY_NM
                    , SYSDATE
                    , SYSDATE
                    , T2.REGER_ID
                    , T2.CHGER_ID
               ) 
	]]>
	</insert>
	
	
	<!-- 상설 이벤트 저장(이벤트 할인 상품),업데이트 -->
	<insert id="insertEventStDcProd" parameterClass="java.util.HashMap">
		   MERGE INTO  EV_EVENT_DC_GOODS T1
           USING (
                   SELECT #eventId#   		AS EVENT_ID        		/* 이벤트 ID */
                   		, #goodsCd# 		AS GOODS_CD				/* 상품 코드 */
                   		, #dspySeq#    		AS DSPY_SEQ				/* 전시일련번호*/
                   		, #pavlnDivCd#    	AS PAVLN_DIV_CD			/* 전시일련번호*/
                     	, #fixamtDc#    	AS FIXAMT_DC        	/* 정액할인 */
                     	, #fixrateDc#    	AS FIXRATE_DC        	/* 정률할인 */
                     	, #dspySpotCd#      AS DSPY_SPOT_CD     	/* 전시위치코드 */
                     	, SYSDATE           AS REG_DATE          	/* 등록일시 */
                     	, SYSDATE       	AS CHG_DATE       		/* 수정일시 */
                     	, #useYn#       	AS USE_YN          		/* 사용여부 */
                      	, #regerId#     	AS REGER_ID           	/* 등록자 아이디 */
                     	, #chgerId#     	AS CHGER_ID             /* 수정자 아이디 */
                     	, #buyLimitCnt#     AS BUY_LIMIT_CNT        /* 구매 제한 수량 */
                     	, #limitSellCnt#    AS LIMIT_SELL_CNT       /* 한정 판매 수량 */
                     	, #dcApplyPrc#      AS DC_APPLY_PRC         /* 할인 적용가 */
                     	, #sortOrder#       AS SORT_ORDER           /* 상품 정렬 순서 */
                     FROM DUAL
           ) T2
           ON (T1.DSPY_SEQ = T2.DSPY_SEQ 
               AND T1.GOODS_CD = T2.GOODS_CD)
           WHEN MATCHED THEN
                  UPDATE SET T1.DSPY_SPOT_CD         = T2.DSPY_SPOT_CD
					<isNotEmpty property="useYn">
                           , T1.USE_YN               = T2.USE_YN
                    </isNotEmpty>
                           , T1.EVENT_ID             = T2.EVENT_ID
					<isNotEmpty property="fixamtDc">
                           , T1.FIXAMT_DC            = T2.FIXAMT_DC
                    </isNotEmpty>
					<isNotEmpty property="fixrateDc">
                           , T1.FIXRATE_DC           = T2.FIXRATE_DC
                    </isNotEmpty>
                    <isNotEmpty property="buyLimitCnt">
                           , T1.BUY_LIMIT_CNT        = T2.BUY_LIMIT_CNT
                    </isNotEmpty>
                    <isNotEmpty property="limitSellCnt">
                           , T1.LIMIT_SELL_CNT       = T2.LIMIT_SELL_CNT
                    </isNotEmpty>
                    <isNotEmpty property="dcApplyPrc">
                           , T1.DC_APPLY_PRC         = T2.DC_APPLY_PRC
                    </isNotEmpty>
                           , T1.SORT_ORDER         	 = T2.SORT_ORDER
                           , T1.CHG_DATE             = SYSDATE
                    <isNotEmpty property="chgerId">
                           , T1.CHGER_ID             = T2.CHGER_ID
                    </isNotEmpty>
           WHEN NOT MATCHED THEN
               INSERT(
                      T1.GOODS_CD
                    , T1.DSPY_SEQ
                    , T1.EVENT_ID
                    , T1.PAVLN_DIV_CD
                <isNotEmpty property="fixamtDc">
                    , T1.FIXAMT_DC
                </isNotEmpty>
                <isNotEmpty property="fixrateDc">
                    , T1.FIXRATE_DC
                </isNotEmpty>
                <isNotEmpty property="useYn">
                    , T1.USE_YN
                </isNotEmpty>
                    , T1.DSPY_SPOT_CD
                <isNotEmpty property="buyLimitCnt">
                    , T1.BUY_LIMIT_CNT
                </isNotEmpty>
                <isNotEmpty property="limitSellCnt">
                    , T1.LIMIT_SELL_CNT
                </isNotEmpty>
                <isNotEmpty property="dcApplyPrc">
                    , T1.DC_APPLY_PRC
                </isNotEmpty>
                    , T1.SORT_ORDER
                    , T1.SELL_CNT
                    , T1.REG_DATE
                    , T1.CHG_DATE
				<isNotEmpty property="regerId">
                    , T1.REGER_ID
                </isNotEmpty>
				<isNotEmpty property="chgerId">
                    , T1.CHGER_ID
                </isNotEmpty>
               )VALUES(
                      T2.GOODS_CD
                    , T2.DSPY_SEQ
                    , T2.EVENT_ID
                    , T2.PAVLN_DIV_CD
                <isNotEmpty property="fixamtDc">
                    , T2.FIXAMT_DC
                </isNotEmpty>
                <isNotEmpty property="fixrateDc">
                    , T2.FIXRATE_DC
                </isNotEmpty>
                <isNotEmpty property="useYn">
                    , T2.USE_YN
                </isNotEmpty>
                    , T2.DSPY_SPOT_CD
                <isNotEmpty property="buyLimitCnt">
                    , T2.BUY_LIMIT_CNT
                </isNotEmpty>
                <isNotEmpty property="limitSellCnt">
                    , T2.LIMIT_SELL_CNT
                </isNotEmpty>
                <isNotEmpty property="dcApplyPrc">
                    , T2.DC_APPLY_PRC
                </isNotEmpty>
                    , T2.SORT_ORDER
                    , '0'
                    , SYSDATE
                    , SYSDATE
                <isNotEmpty property="regerId">
                    , T2.REGER_ID
                </isNotEmpty>
                <isNotEmpty property="chgerId">
                    , T2.CHGER_ID
                </isNotEmpty>
               ) 
	</insert>
	
	
	<!-- 카테고리 자식조회   -->
	<select id="selectCategoryTreeChild" parameterClass="java.util.HashMap" resultClass="commMap">
		<![CDATA[
		SELECT     
			A.CTGRY_NM AS ctgrynm
			, A.CTGRY_LEVEL AS depth
			, B.leaf AS leaf
    		, A.CTGRY_CD as ctgrycd
    		, A.PAVLN_DIV_CD as marketIndex
    		, A.CTGRY_DESC as ctgrydesc
    		, A.HRNK_CTGRY_CD as hrnkctgrycd
    		, A.USE_YN as useyn
    		, A.SORT_ORDER as noticsortorder
    		, A.PN_CTGRY_CD as pnctgrycd
    		, A.REG_DATE as regdate
    		, A.CHG_DATE as chgdate
    		, A.REGER_ID as regerid
    		, A.CHGER_ID as chgerid
		FROM GD_CTGRY_MAST A, 
			(
			SELECT CONNECT_BY_ISLEAF AS LEAF ,CTGRY_CD
				FROM GD_CTGRY_MAST 
			WHERE 1=1 
				START WITH HRNK_CTGRY_CD = #ctgrycd#
				CONNECT BY PRIOR CTGRY_CD = HRNK_CTGRY_CD			
			) B    
	    WHERE A.CTGRY_CD = B.CTGRY_CD 
	    AND  A.HRNK_CTGRY_CD = #ctgrycd#
	    ]]>
			<isNotEmpty property="marketIndex">	
			AND STR_DIV_CD = #marketIndex#
			</isNotEmpty>
		ORDER BY SORT_ORDER DESC
	</select>
	
	
	<!-- 20160210 상설이벤트 진행상태 총 건수 - 진행대기건수-->
	<select id="selectStEventMgrStusTotalCnt" parameterClass="java.util.HashMap" resultClass="int">		
		<![CDATA[
			 SELECT COUNT(1) AS CNT      
			   FROM DP_DSPY_MAST T1
				   , EV_EVENT_MAST T2
			  WHERE T1.DSPY_SEQ = T2.DSPY_SEQ
			    AND T1.DSPY_TYP_CD = '20'    /* 20:상설이벤트 30:기획전 40:특판이벤트 50:모바일이벤트 70:모바일특가 */
			    AND T2.DEL_YN = 'N'
		]]>
			<isNotEmpty property="toTalDspyStusCd">	
				AND T1.DSPY_STUS_CD = #toTalDspyStusCd#
			</isNotEmpty>
	</select>
	<select id="selectStEventMgrStusMap" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">		
		SELECT
			'WT',
			NVL(SUM(CASE WHEN DSPY_STUS_CD = '10' THEN CNT END),0) WT_CNT,
			'SRT',
			NVL(SUM(CASE WHEN DSPY_STUS_CD = '20' THEN CNT END),0) SRT_CNT,
			'PS',
			NVL(SUM(CASE WHEN DSPY_STUS_CD = '30' THEN CNT END),0) PS_CNT,
			'STP',
			NVL(SUM(CASE WHEN DSPY_STUS_CD = '40' THEN CNT END),0) STP_CNT,
			'EXT',
			NVL(SUM(CASE WHEN DSPY_STUS_CD NOT IN ('10','20','30','40') OR  DSPY_STUS_CD IS NULL THEN CNT END),0) EXT_CNT
			FROM
			(
			    SELECT  DSPY_STUS_CD ,COUNT(*) CNT 	   
			        FROM DP_DSPY_MAST T1
			           , EV_EVENT_MAST T2
			           , DP_DSPY_DTAIL T3
			    WHERE T1.DSPY_SEQ = T2.DSPY_SEQ
			    AND T1.DSPY_SEQ = T3.DSPY_SEQ(+)
			    AND T2.DEL_YN = 'N' 
			    <isNotEmpty property="dspy_typ_cd" prepend="AND">	
				 T1.DSPY_TYP_CD = #dspy_typ_cd#
				</isNotEmpty>
				
			    GROUP BY  DSPY_STUS_CD
			 )   
	</select>
	
	
	<!-- 템플릿 구성하기 신규 저장을 위한 (DP 전시 템플릿)일련번호 조회-->
	<select id="selectEventTemplSeq" parameterClass="java.util.HashMap" resultClass="commMap">
	<![CDATA[
		 SELECT SEQ_TEMPL_SEQ.NEXTVAL AS TEMPL_SEQ FROM DUAL
	]]>
	</select>
	
	<!-- 템플릿 구성하기 신규 저장 or 업데이트 -->
	<update id="insertEventTemplatStProdCrtReset" parameterClass="java.util.HashMap">
		UPDATE DP_DSPY_TEMPL 
		   SET TEMPL_DESC = EMPTY_CLOB()
		 WHERE TEMPL_SEQ = #templSeq#
	</update>
	
	<!--  MERGE INTO  DP_DSPY_TEMPL T1
           USING (
               SELECT #templSeq#    	 AS TEMPL_SEQ       	/* 템플릿일련번호 */
                      , #templNm#        AS TEMPL_NM        	/* 템플릿명 */
                      /*, #templDesc#      AS TEMPL_DESC      	 템플릿 설명*/
                      , #templDivCd#     AS TEMPL_DIV_CD    	/* 템플릿 구분코드templDivCd */
                      , #useYn#          AS USE_YN          	/* 사용여부 */
                      , SYSDATE          AS REG_DATE        	/* 등록일시 */
                      , SYSDATE          AS CHG_DATE        	/* 수정일시 */
                      , #regerId#        AS REGER_ID        	/* 등록자 아이디 */
                      , #chgerId#        AS CHGER_ID        	/* 수정자 아이디 */
                      , #templImgWidth#  AS TEMPL_IMG_WIDTH 	/* 이미지 가로 크기 */
                      , #templImgHeight# AS TEMPL_IMG_HEIGHT 	/* 이미지 세로 크기 */
                      , #templImgNum#    AS TEMPL_IMG_NUM 		/* 이미지 진열 수 */
                FROM DUAL
           ) T2
           ON (T1.TEMPL_SEQ = T2.TEMPL_SEQ )
           WHEN MATCHED THEN
               UPDATE SET T1.TEMPL_NM      		= T2.TEMPL_NM
                        , T1.TEMPL_DESC    		= #templDesc#
                        , T1.TEMPL_DIV_CD  		= T2.TEMPL_DIV_CD
                        , T1.USE_YN        		= T2.USE_YN
                        , T1.CHGER_ID      		= T2.CHGER_ID
                        , T1.CHG_DATE      		= SYSDATE
                        , T1.TEMPL_IMG_WIDTH 	= T2.TEMPL_IMG_WIDTH
                        , T1.TEMPL_IMG_HEIGHT 	= T2.TEMPL_IMG_HEIGHT
                        , T1.TEMPL_IMG_NUM 		= T2.TEMPL_IMG_NUM
           WHEN NOT MATCHED THEN
               INSERT(
                      T1.TEMPL_SEQ
                    , T1.TEMPL_NM
                    , T1.TEMPL_DESC
                    , T1.TEMPL_DIV_CD
                    , T1.USE_YN
                    , T1.REG_DATE
                    , T1.REGER_ID
                    , T1.TEMPL_IMG_WIDTH
                    , T1.TEMPL_IMG_HEIGHT
                    , T1.TEMPL_IMG_NUM
               )VALUES(
                      T2.TEMPL_SEQ
                    , T2.TEMPL_NM
                    , #templDesc#
                    , T2.TEMPL_DIV_CD
                    , T2.USE_YN
                    , T2.REG_DATE
                    , T2.REGER_ID
                    , T2.TEMPL_IMG_WIDTH
                    , T2.TEMPL_IMG_HEIGHT
                    , T2.TEMPL_IMG_NUM 
               ) -->
	<!-- 템플릿 신규 저장 -->       
	<insert id="insertEventTemplatStProdCrt" parameterClass="java.util.HashMap">
	
		INSERT INTO DP_DSPY_TEMPL
			(
				  TEMPL_SEQ
				, TEMPL_NM
				, TEMPL_DESC
				, TEMPL_DIV_CD
				, USE_YN
				, REG_DATE
				, REGER_ID
				, TEMPL_IMG_NUM			
				, TEMPL_IMG_WIDTH  /* 진열상품 넓이 */
				, TEMPL_IMG_HEIGHT /* 진열상품 높이 */				
			)
		VALUES
			(
				  #templSeq#       /* 템플릿일련번호 */
                , #templNm#        /* 템플릿명 */
				, #templDesc#      /* 템플릿 설명*/
				, #templDivCd#     /* 템플릿 구분코드templDivCd */
				, #useYn#          /* 사용여부 */
				, SYSDATE          /* 등록일시 */
				, #regerId#        /* 등록자 아이디 */
				, #templImgNum#
				, #templImgWidth#
				, #templImgHeight# 			
			)
	</insert> 
	      
	<!-- 기존 템플릿 업데이트 -->         
	<update id="updateEventTemplatStProdCrt" parameterClass="java.util.HashMap">
	
		UPDATE DP_DSPY_TEMPL 
		   SET TEMPL_NM      		= #templNm#        /* 템플릿명 */
	         , TEMPL_DESC    		= #templDesc#      /* 템플릿 설명 */
	         , TEMPL_DIV_CD  		= #templDivCd#     /* 템플릿 구분코드templDivCd */
	         , USE_YN        		= #useYn#          /* 사용여부 */
	         , CHGER_ID      		= #chgerId#
	         , CHG_DATE      		= SYSDATE          /* 등록일시 */
	         , TEMPL_IMG_NUM 		= #templImgNum#
	         , TEMPL_IMG_WIDTH = #templImgWidth#
	         , TEMPL_IMG_HEIGHT = #templImgHeight# 
	   WHERE TEMPL_SEQ = #templSeq# 
	</update>
	
	
	
	
	<!-- 템플릿 미리보기 -->
	
	<select id="selectEventStTpltPreView" parameterClass="java.util.HashMap" resultClass="commMap">
	<![CDATA[
		SELECT  TEMPL_NM
			  , TEMPL_SEQ        /* 템플릿 일련번호 */
			  , TEMPL_DESC       /* 템플릿 설명 */
			  , TEMPL_DIV_CD     /* 템플릿 구분 코드 */
			  , USE_YN           /* 사용 여부 */
			  , REG_DATE         /* 등록 일시 */
			  , CHG_DATE         /* 수정 일시 */
			  , REGER_ID         /* 등록자 */
			  , CHGER_ID         /* 수정자 */
			  , TEMPL_IMG_WIDTH  /* 진열상품 넓이 */
			  , TEMPL_IMG_HEIGHT /* 진열상품 높이 */
			  , TEMPL_IMG_NUM    /* 진열 상품 진열수 */
		  FROM DP_DSPY_TEMPL
		 WHERE TEMPL_SEQ = #templSeq#
	]]>
	</select>
	
	<!-- 템플릿 조회 -->
	<select id="selectStTemplateList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT TEMPL_SEQ AS VALUE
		     , TEMPL_NM  AS NAME
		  FROM DP_DSPY_TEMPL
		 WHERE USE_YN = 'Y'
		 ORDER BY TEMPL_NM, TEMPL_SEQ
	</select>	
	
	<!--템플릿 경로 조회 -->
	<select id="selectEventStTpltImgPreView" parameterClass="java.util.HashMap" resultClass="commMap">
	<![CDATA[
		 SELECT REPLACE(FILE_STRE_PATH, '\') || '/' || STRE_FILE_NM || '.' ||  FILE_EXTNER AS FILENAME
		       ,ORIG_FILE_NM AS ORIGFILENM
           FROM CM_FILE_MGT
	]]>
           <isNotEmpty property="attchfileId">	
           WHERE ATTCHFILE_ID in (#attchfileId#)
           </isNotEmpty>
	</select>
	
	
	<!-- 기존 템플릿 삭제처리 -->
	<update id="eventDelTemplate" parameterClass="java.util.HashMap">
	
		UPDATE DP_DSPY_TEMPL
		   SET USE_YN = 'N'
		 WHERE TEMPL_SEQ = #templSeq# 
		 
	</update>
	
	
	<!-- 템플릿구성하기의 미리보기 이미지 경로-->
	<select id="selectEventStTpltCrtPreView" parameterClass="map" resultClass="commMap">
		<![CDATA[
			SELECT T2.ORIG_FILE_NM
			  	 , REPLACE(T2.FILE_STRE_PATH, '\') || '/' || T2.STRE_FILE_NM AS FILE_FULL_NAME
              FROM GD_GOODS_IMAGE T1      				/* 상품 이미지 정보 테이블 */
                 , CM_FILE_MGT T2         				/* 이미지 업로드 정보 테이블 */ 
             WHERE T1.REPRSNT_IMAGE = T2.ATTCHFILE_ID
             ]]>
             <isNotEmpty property="goodsArr">
             	AND     
				<iterate property="goodsArr" open="("  close=")" conjunction="OR">
				 	(T1.GOODS_CD = #goodsArr[]#) 
				</iterate>
			</isNotEmpty>
			<isEmpty property="goodsArr">
             	AND 1=2
			</isEmpty>
	</select>
	
	<!--템플릿 기획전 타입 공통코드 -->
	<select id="selectStTemplDivCd"  resultClass="commMap">
		SELECT COMN_CD_ID  AS CODE
             , COMN_CD_NM  AS NAME
          FROM CM_COMN_CD
         WHERE CD_GRP_ID = #cdGrpId#
	</select>
	
	<select id="selectTemplNmChk" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT MAX(TO_CHAR(REG_DATE, 'YYYY-MM-DD HH24:MI')) AS REG_DATE, COUNT(*) AS CNT
		  FROM DP_DSPY_TEMPL
		 WHERE USE_YN = 'Y'
		   AND TRIM(TEMPL_NM) = TRIM(#templ_nm#)
		 GROUP BY TEMPL_NM
		 ORDER BY REG_DATE DESC
	</select>
	
</sqlMap>